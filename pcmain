import requests
import os
import time
import pyautogui
import zipfile
from time import sleep
import subprocess
import requests
import discord_webhook
import json
import wget
from pathlib import Path
from zipfile import ZipFile

sleep(30)
vmfolder = "C:\\vmstart\\Updated"

def linkdow2():
    try:
         try:
             print("link 1")
             response = requests.get("https://dangtapcode.xyz/luutru/vmstart.zip")
         except:
             print ("link 2")
             response = requests.get("https://drive.google.com/uc?id=1sXxOH6sMMbOsBCV6CdeoJaIGjhUv3m8z&export=download&confirm=t&uuid=65846643-d468-4790-9a8b-86c6bc3bc24b")
    except OSError:
        print('No connection to the server!')
        return None
    if response.status_code == 200:
        print('Status 200, OK')
        print ("Downloading")
        open('vmstart.zip', 'wb').write(response.content)
        print ("Downloaded")
        time.sleep(3)
    else:
        print('ZIP file request not successful!.')
        return None
def downzipfile2():
    linkdow2()
    print ("Unziping")
    with zipfile.ZipFile('vmstart.zip', 'r') as zip_ref:
        zip_ref.extractall("C:\\vmstart")
    print ("Unziped")

def downvmstart():  
    time.sleep(1)
    downzipfile2()
    if not os.path.exists(vmfolder):
     os.mkdir(vmfolder)  
     print ("Created Folder Update")  
     
def update1():
    filename = Path('vmware1.png')
    url = 'https://dangtapcode.xyz/luutru/vmware1.png'
    response = requests.get(url)
    filename.write_bytes(response.content)   
    print ("Downloaded vmware1.png")
    
           
if not os.path.exists("C:\\vmstart"):
    os.mkdir("C:\\vmstart")
if not os.path.exists("C:\\vmstart\\vmware1.png"):
    update1()
if not os.path.exists("C:\\vmstart\\Updated"):
    downvmstart()
    os.system("shutdown /r /t  60")
    subprocess.call(["taskkill","/F","/IM","fullypcmain.exe"])

print("???????????????????????")
print("Detected Windows Restart")
print("Starting to open VMware...")

CONFIG_DEFAULTS = {
    'webhook_url': 'https://discord.com/api/webhooks/1111106036959547483/xmBc_DLxhupKBAz7ufDypXjAg0Zk9U8n1XswrSi-QHRyQ_v16jNtRQq01fTN-lI80XwJ',
    'note': 'Opening Vmware Mini',
}

webhook_url = CONFIG_DEFAULTS['webhook_url']
note = CONFIG_DEFAULTS['note']
(f"Webhook URL: {webhook_url}")
(f"Note: {note}")

def post():
 webhook = discord_webhook.DiscordWebhook(url=webhook_url)
 embed = discord_webhook.DiscordEmbed(title="THONG BAO", description=note, color=0x7289da)
 webhook.add_embed(embed)
 response = webhook.execute()
 return response

vm = pyautogui.locateCenterOnScreen("vmware.png")
vm1 = pyautogui.locateCenterOnScreen("vmware1.png")
mycompy = pyautogui.locateCenterOnScreen("mycomputer.png")
mycompy1 = pyautogui.locateCenterOnScreen("mycomputer1.png")
mycompy2 = pyautogui.locateCenterOnScreen("mycomputer2.png")
search = pyautogui.locateCenterOnScreen("search.png")
    
def click():
    # new method
    print("not detected vmware")
    pyautogui.hotkey('win', 's')
    pyautogui.write('VMware Workstation Pro')
    pyautogui.press('enter')
    time.sleep(10)
    pyautogui.hotkey("ctrl", "b")
    print("ok contron b")
    try:
        post()
    except:
        pass
    
    # if not vm or vm1:
    #     print("not detected vmware")
    #     pyautogui.moveTo(search)
    #     print("move to search")
    #     pyautogui.click()
    #     print("click")
    #     time.sleep(3)
    #     pyautogui.write("vmware")
    #     print("write vmware")
    #     pyautogui.press("enter")
    #     print("press enter")
    #     time.sleep(10)
    #     pyautogui.hotkey("ctrl", "b")
    #     print("ok contron b")
    #     post()
    # elif vm:
    #     print("detected vmware")
    #     pyautogui.moveTo(vm)
    #     print("move to vmware")
    #     pyautogui.click()
    #     print("click")
    #     time.sleep(10)
    #     pyautogui.hotkey("ctrl", "b")
    #     print("ok contron b")
    #     post()
    # elif vm1:
    #     print("detected vmware1")
    #     pyautogui.moveTo(vm1)
    #     print("move to vmware1")
    #     pyautogui.click()
    #     print("click")
    #     time.sleep(10)
    #     pyautogui.hotkey("ctrl", "b")
    #     print("ok contron b")
    #     post()
            
click()
print("DONE!")
print("TOOL WILL BE CLOSED AFTER 100 SECOND!")
time.sleep(100)
